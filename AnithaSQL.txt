--CREATED BY ANITHA
--BANKING

CREATE TABLE BRANCHS(BRANCHCODE INT PRIMARY KEY,LOCATION VARCHAR(20) NOT NULL)
CREATE TABLE BANKMASTER(ACNO INT PRIMARY KEY,CNAME VARCHAR(20) NOT NULL,CHECK(LEN(CNAME)<=10),CITY VARCHAR(40) DEFAULT 'HYDERABAD',BALANCE MONEY NOT NULL,CHECK(BALANCE>=500),BRANCHCODE INT FOREIGN KEY REFERENCES BRANCHS(BRANCHCODE))
CREATE TABLE BANKTRANSACTION(ACNO INT FOREIGN KEY REFERENCES BANKMASTER(ACNO),TTYPE CHAR(1) CHECK(TTYPE='W' OR TTYPE='D'),TDATE DATETIME NOT NULL,AMT MONEY NOT NULL)
INSERT INTO BRANCHS VALUES(1001,'AMEERPET')
INSERT INTO BRANCHS VALUES(1002,'BEGUMPET')
INSERT INTO BRANCHS VALUES(1003,'BHEL')
INSERT INTO BRANCHS VALUES(1004,'KUKATPALLY')
INSERT INTO BRANCHS VALUES(1005,'PANJAGUTTA')
SELECT * FROM BRANCHS
SP_HELP 'BRANCHS'
INSERT INTO BANKMASTER VALUES(131,'ANITHA','VIZAY',45000,1001)
INSERT INTO BANKMASTER VALUES(132,'NANDU','GOA',35000,1002)
INSERT INTO BANKMASTER VALUES(133,'HARSHA','HYDERABAD',90000,1003)
INSERT INTO BANKMASTER VALUES(134,'SANJU','BANGOLORE',50000,1004)
INSERT INTO BANKMASTER VALUES(135,'KARTHIK','DELHI',25000,1005)
SELECT * FROM BANKMASTER
SP_HELP 'BANKMASTER'
INSERT INTO BANKTRANSACTION VALUES(131,'W',2011-05-02,15000),(132,'D',2012-08-11,10000),(133,'W',2013-03-10,25000),(134,'D',2014-07-12,5000),(135,'W',2015-10-05,500)
SELECT * FROM BANKTRANSACTION
SP_HELP 'BANKTRANSACTION'

--1
SELECT * FROM BANKMASTER WHERE BALANCE>=30000
--2
SELECT * FROM BRANCHS LEFT JOIN BANKMASTER ON BRANCHS.BRANCHCODE=BANKMASTER.BRANCHCODE
--3
SELECT * FROM BANKTRANSACTION WHERE TTYPE=(SELECT MAX(TTYPE) AS MAXIMUMTYPE FROM BANKTRANSACTION WHERE TTYPE='W')
--4
SELECT BANKMASTER.*,BRANCHS.* FROM BANKMASTER,BRANCHS WHERE BRANCHS.BRANCHCODE=BANKMASTER.BRANCHCODE AND BANKMASTER.BRANCHCODE IN
(SELECT BRANCHCODE FROM BANKMASTER GROUP BY BRANCHCODE HAVING SUM(BALANCE)>10000)
--5
CREATE NONCLUSTERED INDEX I1 ON BRANCHS(LOCATION)
--6
CREATE TRIGGER T1
ON BANKTRANSACTION
FOR INSERT
AS
BEGIN
INSERT INTO BANKTRANSACTION SELECT ACNO,TTYPE,TDATE,AMT
END
INSERT INTO BANKTRANSACTION(ACNO,TTYPE,TDATE,AMT) VALUES (136,'W',27-09-2020,102000)
IF @TTYPE='D'
UPDATE BANKMASTER SET BALANCE=BALANCE+1500 WHERE ACNO=@ACNO
ELSE
UPDATE BANKMASTER SET BALANCE=BALANCE-500 WHERE ACNO=@ACNO
CLOSE T1
DEALLOCATE T1
END
--7
CREATE VIEW V1 AS SELECT BALANCE FROM BANKMASTER WHERE BALANCE>5000
SELECT * FROM V1
--8
CREATE PROC BANK(@ACTNO INT)
AS
BEGIN
SELECT * FROM BANKMASTER WHERE ACNO=@ACTNO
END

       EXEC BANK 133
	
--9
SELECT * FROM BANKTRANSACTION ORDER BY TDATE
--10
CREATE FUNCTION INTEREST(@AC INT)
RETURNS FLOAT
BEGIN
DECLARE @B FLOAT,@BAL INT,@J INT
SELECT @J=BALANCE FROM BANKMASTER WHERE ACNO=@AC
IF @J>=100000
BEGIN
SET @D=@J*0.1
END

DECLARE @A INT
SET @A=DBO.INTEREST(131)
PRINT @A
UPDATE BANKMASTER SET BALANCE=@A WHERE ACNO=131
SELECT * FROM BANKMASTER

--11
SELECT * FROM BANKMASTER B WHERE 2=(SELECT COUNT(DISTINCT BALANCE) FROM BANKMASTER WHERE BALANCE>B.BALANCE)
